asyncapi: '2.6.0'
info:
  title: Tracking of bookings API
  version: '1.0.0'
  description: API for real-time tracking of bookings via WebSocket

servers:
  production:
    url: wss://api.example.com
    protocol: wss
    description: Production WebSocket server

channels:
  /tracking/{bookingId}:
    description: Channel for tracking booking updates
    parameters:
      bookingId:
        description: Unique booking identifier
        schema:
          type: string
          pattern: '^BOOK_[A-Za-z0-9]{10}$'
    subscribe:
      summary: Client receives driver location updates
      message:
        oneOf:
          - $ref: '#/components/messages/DriverLocation'
    publish:
      summary: Driver sends location updates to the server
      message:
        oneOf:
          - $ref: '#/components/messages/LocationUpdate'

components:
  messages:
    LocationUpdate:
      name: locationUpdate
      title: Location Update
      summary: Location update message from driver
      contentType: application/json
      payload:
        type: object
        properties:
          bookingId:
            type: string
          latitude:
            type: number
          longitude:
            type: number
          timestamp:
            type: string
            format: date-time
        required:
          - bookingId
          - latitude
          - longitude
          - timestamp

    DriverLocation:
      name: driverLocation
      title: Driver Location
      summary: Location broadcast from server to client
      contentType: application/json
      payload:
        type: object
        properties:
          bookingId:
            type: string
          driverId:
            type: string
          position:
            type: object
            properties:
              lat:
                type: number
              lng:
                type: number
            required:
              - lat
              - lng
          timestamp:
            type: string
            format: date-time
        required:
          - bookingId
          - driverId
          - position
          - timestamp
